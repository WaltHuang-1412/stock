# 📊 台股智能分析系統

一個基於真實法人數據的台股分析工具，提供個人持股管理和投資建議。

## ✨ 核心特色

- 🔍 **動態市場掃描**: 自動分析全台股1,262檔股票
- 📈 **真實法人數據**: 串接證交所官方API，無假資料
- 💼 **個人持股管理**: 追蹤你的投資組合表現
- 🤖 **智能問答**: 自然語言查詢股票資訊
- 📊 **多維分析**: 法人動向、技術面、基本面整合分析

## 🚀 快速開始

### 1. 環境設置
```bash
# 安裝依賴
pip install -r requirements.txt
```

### 2. 設定個人持股
編輯 `my_holdings.yaml` 檔案，填入你的實際持股：

```yaml
holdings:
  - symbol: "2330"           # 台積電
    name: "台積電"
    buy_price: 500.0         # 買入價格
    quantity: 2              # 持有張數
    buy_date: "2024-01-15"   # 買入日期
    notes: "核心持股"

# 投資策略設定 (選填)
strategy:
  stop_loss_percent: -10     # 停損比例 (%)
  take_profit_percent: 20    # 停利比例 (%)  
  risk_tolerance: "medium"   # 風險承受度: low/medium/high
```

### 3. 執行範例
```bash
# 運行所有使用範例
python3 examples.py

# 或單獨測試持股分析
python3 portfolio_analyzer.py
```

### 4. 開始使用

#### 互動模式
```bash
python3 main.py
```

#### 單次查詢模式
```bash
# 查詢特定股票
python3 main.py -q "台積電最近法人怎麼看？"

# 獲取推薦股票
python3 main.py -q "給我十檔可以進場參考的台股"

# 分析個人持股
python3 portfolio_analyzer.py
```

## 📖 詳細使用範例

### 範例1: 查詢單一股票分析
```bash
$ python3 main.py -q "2330 法人分析"
```
輸出：
```
🏛️ **台積電 (2330) 法人分析**
════════════════════════════════════

📊 **三大法人買賣超 (近期)**
• 外資: +15,234 張 (持續買超)
• 投信: +2,456 張 (加碼)
• 自營商: -1,123 張 (小幅賣超)

💡 **投資建議:**
• ✅ 外資持續看好，可續抱
• 📈 技術面突破壓力，建議進場
• 🎯 目標價: 520-550
```

### 範例2: 獲取市場推薦
```bash
$ python3 main.py -q "推薦進場的台股"
```
輸出：
```
🎯 **法人推薦進場標的 (前10名)**
════════════════════════════════════

1. 廣達 (2382) - 外資買超 +18,456張
   💡 AI伺服器需求強勁，建議進場價位: 280-285

2. 台積電 (2330) - 外資買超 +25,123張  
   💡 先進製程龍頭，建議進場價位: 500-510

3. 聯發科 (2454) - 投信買超 +5,678張
   💡 手機晶片復甦，建議進場價位: 750-760
```

### 範例3: 個人持股分析
```bash
$ python3 portfolio_analyzer.py
```
輸出：
```
📊 **個人持股分析報告**
════════════════════════════════════

💰 **投資組合概況**
總成本: 407,500 元
目前市值: 424,146 元  
總損益: +16,646 元 (+4.3%)

📈 **個股分析**

**廣達 (2382)**
買入價: 270.4 → 現價: 283.5
持有: 1 張
損益: +13,100 元 (+4.9%)

**離場建議**:
• 📊 目前可持續觀察

**力積電 (6770)**
買入價: 21.5 → 現價: 23.9
持有: 1 張
損益: +2,400 元 (+10.8%)

**離場建議**:
• 📈 建議先獲利了結30-50%，剩餘持股續抱
```

## 🔍 支援的查詢類型

### 法人分析
```bash
python3 main.py -q "2330法人分析"
python3 main.py -q "台積電法人怎麼看"
python3 main.py -q "廣達最近外資買超情況"
```

### 技術分析
```bash
python3 main.py -q "2454技術面分析"
python3 main.py -q "聯發科走勢分析"
python3 main.py -q "力積電支撐壓力在哪"
```

### 市場推薦
```bash
python3 main.py -q "推薦進場股票"
python3 main.py -q "給我十檔可以買的台股"
python3 main.py -q "推薦5檔值得投資的股票"
```

### 新聞與資訊
```bash
python3 main.py -q "台積電最新消息"
python3 main.py -q "半導體類股新聞"
python3 main.py -q "今天熱門股票"
```

## 📊 分析結果解讀

### 法人分析結果說明
```
🏛️ **台積電 (2330) 法人分析**
• 外資: +15,234 張 (持續買超)    ← 正數表示買超，負數表示賣超
• 投信: +2,456 張 (加碼)         ← 投信通常代表內資法人看法  
• 自營商: -1,123 張 (小幅賣超)  ← 自營商較短期導向

💡 **投資建議:**
• ✅ 外資持續看好，可續抱      ← 綠色勾號表示正面訊號
• ⚠️ 注意自營商賣超壓力        ← 黃色警告表示需留意
• 🚨 建議立即減碼              ← 紅色警示表示風險訊號
```

### 持股分析解讀
```
**台積電 (2330)**
買入價: 485.5 → 現價: 520.0      ← 價格變化
持有: 3 張                        ← 你的持股數量  
損益: +103,500 元 (+7.1%)        ← 獲利金額和百分比

**離場建議**:
• ✅ 外資持續買超，可續抱觀察      ← 基於法人動向的建議
• 📈 已有不錯獲利，可部分獲利了結  ← 基於獲利幅度的建議
• 🚨 建議立即停損離場             ← 如果虧損達到設定的停損點
```

## ⚠️ 常見問題與解決

### Q1: 無法獲取股價資料
```
❌ 錯誤: 無法獲取 2330 股價資訊

解決方法:
1. 檢查網路連線
2. 確認股票代號正確 (台股為4位數字)
3. 避免在非交易時間大量查詢
4. 稍後重試 (可能是API暫時限制)
```

### Q2: 查詢回應很慢
```
💡 優化建議:
1. 使用股票代號而非公司名稱查詢
2. 避免同時查詢過多股票
3. 在交易時間查詢速度較快
4. 檢查網路連線品質
```

### Q3: 持股檔案格式錯誤
```
❌ 錯誤: YAML格式錯誤

常見問題:
1. 縮排必須使用空格，不能用Tab
2. 冒號後面要有空格
3. 字串建議用雙引號包圍
4. 數字不要用引號包圍

正確範例:
symbol: "2330"        ✅
buy_price: 485.5      ✅

錯誤範例:  
symbol:"2330"         ❌ (缺少空格)
buy_price: "485.5"    ❌ (數字不需引號)
```

## 🎯 使用技巧

### 1. 建立每日監控習慣
```bash
# 建議每日執行
python3 portfolio_analyzer.py

# 每週檢視推薦清單  
python3 main.py -q "推薦股票"
```

### 2. 設定合理的停損停利點
```yaml
strategy:
  # 保守型投資者
  stop_loss_percent: -5
  take_profit_percent: 15
  
  # 積極型投資者  
  stop_loss_percent: -10
  take_profit_percent: 30
```

### 3. 結合多種分析
```bash
# 先看推薦
python3 main.py -q "推薦進場股票"

# 再做個股深度分析
python3 main.py -q "2330綜合分析"

# 最後檢視持股狀況
python3 portfolio_analyzer.py
```

## 🔧 系統架構

```
stock/
├── main.py              # 主程式入口
├── data_fetcher.py      # 數據獲取模組 (502行)
├── analyzer.py          # 股票分析引擎 (340行)
├── query_parser.py      # 查詢解析器 (209行)  
├── portfolio_analyzer.py # 個人持股分析 (196行)
├── utils.py             # 工具函數 (272行)
├── examples.py          # 使用範例腳本
├── config.yaml          # 系統設定
├── my_holdings.yaml     # 個人持股設定
└── requirements.txt     # 依賴套件
```

### 核心模組說明
- **data_fetcher.py**: 動態掃描全市場1,262檔台股，串接證交所API
- **analyzer.py**: 多維度分析引擎，整合法人、技術、新聞分析  
- **portfolio_analyzer.py**: 個人持股管理，計算損益並提供離場建議
- **query_parser.py**: 智能查詢解析，支援自然語言問股票

## ⚙️ 完整設定範例

### my_holdings.yaml (你的實際持股)
```yaml
holdings:
  - symbol: "2382"           # 廣達
    name: "廣達" 
    buy_price: 270.384       # 實際買入價格
    quantity: 1              # 1張
    notes: "實際持股"
    
  - symbol: "2884"           # 玉山金
    name: "玉山金"
    buy_price: 33.848
    quantity: 1
    notes: "實際持股"
    
  - symbol: "6770"           # 力積電
    name: "力積電"
    buy_price: 21.53
    quantity: 1
    notes: "實際持股"

# 投資策略
strategy:
  stop_loss_percent: -10     # 停損-10%
  take_profit_percent: 20    # 停利+20%
  risk_tolerance: "medium"   # 中等風險
```

### config.yaml (系統設定)  
```yaml
analysis:
  institutional_weight: 0.4  # 法人分析權重40%
  technical_weight: 0.3      # 技術分析權重30%
  news_weight: 0.2          # 新聞分析權重20%
  fundamental_weight: 0.1    # 基本面權重10%

data_sources:
  twse_enabled: true         # 啟用證交所數據
  yahoo_enabled: true        # 啟用Yahoo Finance
  timeout: 10               # API請求超時10秒

display:
  max_recommendations: 10    # 最多推薦10檔股票
  show_details: true        # 顯示詳細分析
  use_emojis: true          # 使用表情符號
```

## 🚨 重要注意事項

### 數據來源與限制
1. **真實數據**: 100%使用證交所和Yahoo Finance真實數據，無模擬資料
2. **更新頻率**: 法人數據通常有1-2小時延遲
3. **查詢限制**: 避免短時間內大量查詢，以免觸發API限制
4. **交易時間**: 盤中查詢速度較快，盤後可能較慢

### 投資風險警告  
1. **僅供參考**: 所有分析結果僅供投資參考，不構成買賣建議
2. **風險自負**: 投資有風險，請根據自身狀況謹慎決策
3. **及時性**: 市場變化快速，請以最新資訊為準
4. **多元分析**: 建議結合多種資訊來源進行投資決策

## 📊 專案統計

- **總代碼行數**: 1,781行
- **核心模組**: 6個Python檔案
- **功能完整度**: 85% (核心分析功能完成)
- **支援查詢**: 法人、技術、推薦、新聞分析
- **數據覆蓋**: 全台股1,262檔股票

## 📞 支援與回饋

如有問題或建議:
- 查看 `examples.py` 了解詳細用法
- 檢查 `my_holdings.yaml` 格式是否正確
- 確認網路連線和API可用性

## 📄 免責聲明

本軟體僅供教育和研究目的使用。所有投資建議僅供參考，使用者應自行承擔投資風險。開發者不對任何投資損失負責。請務必在投資前進行充分的風險評估。

---
**版本**: v1.0.0 | **更新**: 2024年12月 | **Python**: 3.9+ | **狀態**: 穩定版