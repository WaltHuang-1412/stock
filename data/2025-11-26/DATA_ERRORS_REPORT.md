# 本週數據錯誤報告（2025-11-25 至 2025-11-26）

**報告時間**：2025-11-26 12:20
**檢查範圍**：11/25（週一）至 11/26（週三）所有分析文件
**檢查人員**：Claude Code

---

## 🚨 嚴重錯誤：外資數據全部錯誤

### 根本原因

**check_institutional.py 程式錯誤**（已於 2025-11-26 12:10 修正）

```python
# ❌ 錯誤寫法（舊版）
foreign_net = int(row[4].replace(',', ''))  # row[4] 永遠是 0

# ✅ 正確寫法（新版）
foreign_net = int(row[3].replace(',', ''))  # row[3] 才是外資數據
```

**影響範圍**：
- 所有使用 `check_institutional.py` 的分析（2025-10-01 至 2025-11-26 09:30）
- 所有寫入「外資 0張」的地方都是錯誤的

---

## 📋 錯誤清單

### 1. ❌ data/2025-11-25/after_market_analysis.md

**錯誤數據**：

| 位置 | 錯誤內容 | 正確數據 |
|------|---------|---------|
| 第147行 | 外資：0張 ⚠️ | 外資：-16,159張 🔴賣超 |
| 第153行 | 外資：0張 ⚠️（連續未進場） | 外資：-13,525張 🔴賣超 |
| 第167行 | ⚠️ 外資連續0張（未解除） | ⚠️ 外資連續賣超 |
| 第316行 | 欣興外資0張未解除 | 需重新查證欣興外資數據 |

**影響評估**：
- 永豐金、彰銀：被評估為「外資未進場」，實際是「外資大賣超」
- 風險評估不足：未警告「投信vs外資激烈對決」
- 推薦仍成功（永豐金+0.94%、彰銀+1.00%），但風險警告不足

---

### 2. ❌ data/2025-11-26/before_market_analysis.md

**錯誤數據**：

| 股票 | 錯誤內容 | 正確數據 | 影響 |
|------|---------|---------|------|
| 富邦金(2881) | 外資0張 | 外資-28,339張 🔴賣超 | 評分86分可能過高 |
| 永豐金(2890) | 外資0張 | 外資-16,159張 🔴賣超 | 評分85分可能過高 |
| 彰銀(2801) | 外資0張 | 外資-13,525張 🔴賣超 | 評分83分可能過高 |

**具體錯誤位置**：
- 第108行：富邦金「⚠️ 外資0張（但投信力道超強、三大仍買超）」
- 第140行：富邦金「外資0張（雖投信力道超強、仍需注意）」
- 第155行：永豐金「⚠️ 外資0張、三大-3.6K（資金對決，但投信主導）」
- 第202行：彰銀「⚠️ 外資0張、三大-1.1K（資金對決，但投信主導）」

**影響評估**：
- **評分錯誤**：基於錯誤數據的五維度評分（法人數據應該扣分）
- **風險警告不足**：未充分警告「投信vs外資激烈對決」
- **推薦倉位可能過高**：富邦金15-20%、永豐金10-15%、彰銀10-15%

---

### 3. ❌ data/tracking/tracking_2025-11-26.json

**錯誤數據**：

```json
{
  "symbol": "2890",
  "name": "永豐金",
  "institutional_data": {
    "date_11_24": {
      "trust": 13449,
      "foreign": 0,           // ❌ 錯誤：應該是 -9,246
      "dealer": "數據異常",
      "total": 5374
    },
    "date_11_25": {
      "trust": 12137,
      "foreign": 0,           // ❌ 錯誤：應該是 -16,159
      "dealer": 395,
      "total": -3627
    }
  }
}
```

**同樣錯誤**：彰銀、欣興、凱基金、台積電的 tracking 數據

**影響**：
- tracking.json 被用於盤中分析（防止事後諸葛）
- 錯誤數據會影響盤中分析的判斷

---

### 4. ❌ data/tracking/tracking_2025-11-25.json

**同樣問題**：所有股票的外資數據都是 0 或錯誤

---

## ✅ 正確數據（修正後）

### 11/24 法人數據

| 股票 | 投信 | 外資 | 自營商 | 三大法人 |
|------|------|------|--------|---------|
| 富邦金(2881) | +42,857 | **-26,548** | +446 | +16,755 |
| 永豐金(2890) | +13,449 | **-9,246** | +1,171 | +5,374 |
| 彰銀(2801) | +12,399 | **-13,765** | +1,122 | -244 |

### 11/25 法人數據

| 股票 | 投信 | 外資 | 自營商 | 三大法人 |
|------|------|------|--------|---------|
| 富邦金(2881) | +46,597 | **-28,339** | -360 | +17,898 |
| 永豐金(2890) | +12,137 | **-16,159** | +395 | -3,627 |
| 彰銀(2801) | +12,409 | **-13,525** | +12 | -1,104 |

---

## 🔍 對決分析（正確版）

### 富邦金(2881)

**11/24-11/25 連續對決**：
- 投信：+42,857 → +46,597（力道加強）
- 外資：-26,548 → -28,339（賣壓加重）
- 對決比例：投信/外資 = 1.64:1（投信略佔上風）
- 三大法人：仍買超+17,898（投信主導）

**評估**：
- ✅ 投信主導年底作帳邏輯
- ⚠️ 外資連續大賣超、短線震盪風險高
- 建議：降低倉位至 10-15%（原15-20%）

---

### 永豐金(2890)

**11/24-11/25 對決加劇**：
- 投信：+13,449 → +12,137（維持買超）
- 外資：-9,246 → -16,159（賣壓加重）
- 對決比例：投信/外資 = 0.75:1（**外資更強！**）
- 三大法人：-3,627（外資主導）

**評估**：
- ⚠️ 外資賣壓大於投信買盤
- ⚠️ 11/25三大賣超-3,627
- 建議：降低倉位至 5-10%（原10-15%）或暫緩進場

---

### 彰銀(2801)

**11/24-11/25 勢均力敵**：
- 投信：+12,399 → +12,409（穩定買超）
- 外資：-13,765 → -13,525（穩定賣超）
- 對決比例：投信/外資 = 0.92:1（勢均力敵）
- 三大法人：-1,104（外資略佔上風）

**評估**：
- ⚠️ 投信vs外資勢均力敵、方向不明
- 建議：降低倉位至 5-10%（原10-15%）或暫緩進場

---

## 📊 需要修正的文件

### 優先級1（高）：

1. **data/2025-11-26/before_market_analysis.md**
   - 更新外資數據
   - 重新評估富邦金、永豐金、彰銀評分
   - 調整推薦倉位

2. **data/tracking/tracking_2025-11-26.json**
   - 更新所有股票的外資數據

### 優先級2（中）：

3. **data/2025-11-25/after_market_analysis.md**
   - 更新外資數據
   - 補充風險警告

4. **data/tracking/tracking_2025-11-25.json**
   - 更新所有股票的外資數據

---

## ✅ 已修正項目

1. **check_institutional.py**（2025-11-26 12:10 修正）
   - 外資欄位：row[4] → row[3]
   - 測試通過：富邦金、永豐金、彰銀數據正確

2. **data/2025-11-26/intraday_analysis.md**（2025-11-26 12:14 完成）
   - 已標註數據錯誤警告
   - 建議暫緩進場永豐金、彰銀

---

## 🎯 後續行動

### 立即執行（用戶決定）：

- [ ] A. 修正 11/26 盤前分析（更新外資數據+重新評分）
- [ ] B. 修正 tracking.json（更新外資數據）
- [ ] C. 修正 11/25 盤後分析（補充風險警告）
- [ ] D. 暫不修正（等盤後分析時一併處理）

### 建議優先順序：

1. **立即修正 tracking.json**（影響盤中/盤後分析）
2. **立即修正 11/26 盤前分析**（避免用戶基於錯誤數據進場）
3. 盤後再修正 11/25 分析（補充記錄）

---

## 📌 教訓總結

1. **程式碼必須驗證**
   - check_institutional.py 上線時未充分測試
   - 應該對照證交所官網驗證數據正確性

2. **關鍵數據必須複查**
   - 外資數據是五維度評分的關鍵
   - 應該建立自動驗證機制（三大 = 投信 + 外資 + 自營）

3. **錯誤影響範圍**
   - 一個程式錯誤影響所有分析（2個月）
   - 需要建立數據品質檢查機制

---

**檢查完成時間**：2025-11-26 12:20
**下一步**：等待用戶決定是否修正文件
