# 強化分析系統規劃：週報+個股追蹤+策略回測

**規劃日期**：2025-11-20
**目的**：解決「盤前盤中盤後不夠」問題，建立多維度分析體系

---

## 🎯 核心目標

### 問題診斷
**現有系統**：
- ✅ 盤前分析（09:00前）
- ✅ 盤中分析（12:30）
- ✅ 盤後分析（14:30後）

**不足之處**：
- ❌ 缺少週期性總結（看不到趨勢）
- ❌ 推薦股票後沒追蹤（不知道是否成功）
- ❌ 無法驗證策略有效性（憑感覺選股）

### 解決方案
**B+C+E組合**：
- 📊 **B - 週報/月報**：看到趨勢、產業輪動
- 🎯 **C - 個股追蹤**：推薦後7日驗證、提升準確率
- ⚡ **E - 策略回測**：量化驗證規則有效性

---

## 📊 系統架構總覽

```
┌─────────────────────────────────────────────┐
│         強化分析系統（三大支柱）              │
└─────────────────────────────────────────────┘
                      │
        ┌─────────────┼─────────────┐
        │             │             │
   ┌────▼────┐  ┌────▼────┐  ┌────▼────┐
   │週報/月報│  │個股追蹤 │  │策略回測 │
   │(B)      │  │(C)      │  │(E)      │
   └────┬────┘  └────┬────┘  └────┬────┘
        │             │             │
   ┌────▼────────────▼─────────────▼────┐
   │   整合至每日分析流程（盤前/盤中/盤後）│
   └─────────────────────────────────────┘
```

---

## 📊 支柱一：週報/月報系統

### 週報（每週五15:00後）

**檔案位置**：`data/weekly/YYYY-MM-DD_weekly_report.md`

**內容架構**（8大章節）：

#### 1. 本週市場總結（20%）
```markdown
### 📈 本週大盤表現
- 加權指數：XX,XXX點（週漲跌±X.X%）
- 成交量：日均XXX億（較上週±X%）
- 族群表現：半導體+X%、金融股-X%、記憶體+X%

### 🌍 國際影響
- 美股四大指數週表現
- 輝達、台積電ADR週表現
- 重大事件：Fed決議、CPI數據、財報季
```

#### 2. 本週法人動向（30%）
```markdown
### 💰 投信本週策略
- 買超TOP5產業：金融股+XXK、半導體+XXK
- 賣超TOP5產業：傳產-XXK、航運-XXK
- 核心判斷：投信主攻XX產業

### 🌏 外資本週策略
- 買超TOP5：台積電+XXK、日月光+XXK
- 賣超TOP5：金融股-XXK、記憶體-XXK
- 核心判斷：外資看好/看壞XX產業

### 🔥 法人一致買超（機會）
- 投信+外資同向買超股票（THIS WEEK）
- 持續買超週數
- 下週關注重點
```

#### 3. 本週推薦股票績效（30%）
```markdown
### ✅ 成功案例（週漲幅>3%）
| 日期 | 股票 | 推薦價 | 週五收盤 | 漲幅 | 推薦理由 | 驗證 |
|------|------|--------|---------|------|---------|------|
| 11/18 | 南亞 | 52.5 | 56.2 | +7.0% | 投信+外資買超 | ✅成功 |

### ❌ 失敗案例（週跌幅<-3%）
| 日期 | 股票 | 推薦價 | 週五收盤 | 跌幅 | 推薦理由 | 失敗原因 |
|------|------|--------|---------|------|---------|----------|
| 11/18 | 富邦金 | 98.5 | 95.2 | -3.4% | 投信買超 | 外資0張陷阱 |

### 📊 本週準確率
- 推薦總數：10檔
- 成功：7檔（週漲幅>3%）
- 失敗：3檔（週跌幅<-3% or 未達預期）
- **準確率：70%**
```

#### 4. 產業輪動分析（10%）
```markdown
### 🔄 資金流向
- 流入：半導體（投信+XXK、外資+XXK）
- 流出：金融股（投信+XXK、外資-XXK 對決）
- 觀望：記憶體（法人買賣互抵）

### 📈 強勢產業（本週）
1. AI供應鏈（台積電、日月光、聯發科）
2. 塑化龍頭（南亞、台塑）

### 📉 弱勢產業（本週）
1. 金融股（法人對決）
2. 面板（友達、群創）
```

#### 5. 下週展望與策略（10%）
```markdown
### 🔮 下週重要事件
- 11/21（四）台積電法說會
- 11/22（五）美國感恩節休市
- 11/25（一）美股半日交易

### 📋 下週關注股票
1. 台積電（法說會、輝達利多發酵？）
2. 金融股（法人態度是否明確？）
3. 南亞科（HBM記憶體需求）

### 💰 下週配置建議
- 現金比例：XX%
- 持股方向：XX產業
- 避開：XX產業（法人對決）
```

---

### 月報（每月最後一個週五）

**檔案位置**：`data/monthly/YYYY-MM_monthly_report.md`

**內容架構**（簡化版）：

#### 1. 本月產業趨勢（40%）
```markdown
### 📈 產業月線表現
- 半導體：+X%（月線多頭）
- 金融股：-X%（月線空頭）
- 記憶體：震盪（無明確趨勢）

### 💰 法人月度持股變化
- 投信：本月主攻XX產業（連續4週買超）
- 外資：本月賣超XX產業（連續4週賣超）
```

#### 2. 本月推薦績效（30%）
```markdown
### 📊 月度準確率
- 推薦總數：40檔
- 成功：28檔（7日漲幅>3%）
- 失敗：12檔
- **月度準確率：70%**

### 📈 最佳推薦（月漲幅TOP3）
1. 南亞：+15.2%（推薦4次、全數成功）
2. 台積電：+8.5%（推薦2次、成功1次）

### 📉 最差推薦（月跌幅TOP3）
1. 富邦金：-8.3%（法人對決、外資0張）
```

#### 3. 下月展望（30%）
```markdown
### 🔮 12月重要事件
- 12/18 Fed利率決議
- 12月財報季開始
- 年底作帳行情

### 📋 下月策略
- 重點產業：XX
- 避開產業：XX
- 配置比例：現金XX%、持股XX%
```

---

## 🎯 支柱二：個股追蹤系統

### 核心概念
**問題**：盤前推薦股票後就沒追蹤，不知道是否成功
**解決**：推薦後自動追蹤7日，驗證準確率

### 追蹤流程

#### Step 1: 盤前推薦時建立追蹤記錄
**檔案**：`data/tracking/tracking_YYYY-MM-DD.json`

```json
{
  "date": "2025-11-20",
  "recommendations": [
    {
      "stock_code": "1303",
      "stock_name": "南亞",
      "recommend_price": 52.5,
      "recommend_reason": "投信+外資一致買超+18,075K",
      "target_price": 58.0,
      "stop_loss": 48.3,
      "position_size": "10-15%",
      "tracking_days": 7,
      "status": "tracking"
    }
  ]
}
```

#### Step 2: 每日自動更新追蹤狀態
**工具**：`scripts/stock_tracker.py`

```python
# 每日執行（盤後14:30後）
python3 scripts/stock_tracker.py

# 功能：
# 1. 讀取所有追蹤中的股票
# 2. 獲取今日收盤價、法人數據
# 3. 更新追蹤記錄
# 4. 判斷是否達標/停損/7日到期
```

**更新後格式**：
```json
{
  "stock_code": "1303",
  "stock_name": "南亞",
  "recommend_price": 52.5,
  "current_price": 56.2,
  "gain_loss": "+7.0%",
  "days_tracked": 5,
  "institutional_data": {
    "day1": {"investment": 8234, "foreign": 9841},
    "day2": {"investment": 3421, "foreign": 5632},
    ...
  },
  "status": "success",  // success / stop_loss / tracking / expired
  "conclusion": "✅ 推薦成功 - 7日漲幅+7.0%、法人持續買超"
}
```

#### Step 3: 7日後產生追蹤報告
**檔案**：`data/tracking/reports/YYYY-MM-DD_7day_report.md`

```markdown
# 2025-11-20 推薦股票 7日追蹤報告

## 📊 推薦總覽
- 推薦日期：2025-11-20
- 推薦股票：1檔（南亞）
- 追蹤期間：2025-11-20 至 2025-11-29（7日）

## ✅ 成功案例

### 南亞(1303) - 推薦成功 +7.0%
- 推薦價：52.5元
- 7日收盤：56.2元
- 漲幅：+7.0%
- 法人態度：持續買超（投信+15K、外資+22K）
- 結論：✅ 推薦正確、策略有效

## 📈 準確率統計
- 本次準確率：100%（1/1）
- 近7日準確率：70%（7/10）
- 近30日準確率：68%（20/29）
```

---

### 個股追蹤整合至每日分析

**盤後分析新增章節**：
```markdown
## 九、追蹤中股票更新

### 📊 7日內推薦股票追蹤

| 股票 | 推薦日 | 推薦價 | 現價 | 漲跌% | 天數 | 法人態度 | 狀態 |
|------|--------|--------|------|-------|------|---------|------|
| 南亞 | 11/18 | 52.5 | 56.2 | +7.0% | 2/7 | 續買超 | ✅追蹤中 |
| 台積電 | 11/19 | 1405 | 1395 | -0.7% | 1/7 | 法人對決 | ⚠️觀察 |

### 🚨 今日達標/停損
- 南亞：推薦2日漲+7.0%，接近目標價58元，**建議減碼50%**
```

---

## ⚡ 支柱三：策略回測系統

### 核心概念
**問題**：不知道「法人買超>10K」、「外資0張=不碰」等規則是否有效
**解決**：統計歷史數據，量化驗證策略準確率

### 回測策略清單

**策略1：法人一致買超（投信+外資同向）**
```
條件：
- 投信買超>10,000張
- 外資買超>5,000張
- 三大法人買超>15,000張

回測：
- 樣本數：過去30日符合條件的股票
- 成功定義：7日漲幅>3%
- 失敗定義：7日跌幅<-3% or 未達預期
```

**策略2：外資0張陷阱（避開）**
```
條件：
- 投信買超>5,000張
- 外資0張 or 賣超
- 三大法人買超 or 賣超

回測：
- 樣本數：過去30日符合條件的股票
- 驗證：若推薦會導致虧損的比例
- 結論：外資0張是否真的是陷阱？
```

**策略3：法人對決（投信買vs外資賣）**
```
條件：
- 投信買超>10,000張
- 外資賣超>10,000張

回測：
- 投信對 vs 外資對 誰勝率高？
- 金融股 vs 半導體，法人對決結果是否不同？
```

**策略4：連續買超（3日以上）**
```
條件：
- 投信連續3日買超
- 每日買超>5,000張

回測：
- 連續買超是否比單日買超準確？
- 連續幾日成功率最高？
```

### 回測工具

**檔案**：`scripts/strategy_backtest.py`

```python
# 執行回測
python3 scripts/strategy_backtest.py --strategy "法人一致買超" --period 30

# 輸出報告
data/backtest/strategy_法人一致買超_20251120.md
```

**報告格式**：
```markdown
# 策略回測報告：法人一致買超

**回測期間**：2025-10-21 至 2025-11-20（30日）
**策略條件**：投信>10K + 外資>5K + 同向買超

## 📊 回測結果

### 樣本統計
- 符合條件：15檔
- 7日漲幅>3%：10檔（成功）
- 7日跌幅<-3%：3檔（失敗）
- 震盪±3%：2檔（中性）

### 成功率
- **整體成功率：66.7%（10/15）**
- 平均漲幅：+5.2%
- 平均跌幅：-4.1%

### 產業分佈
- 半導體：80%成功率（4/5）
- 金融股：50%成功率（2/4）
- 塑化：100%成功率（2/2）

### 失敗案例分析
1. 富邦金：投信+25K、外資-40K（實際外資0張陷阱）
2. 旺宏：投信+8K、外資+6K（已大漲20%、追高失敗）

## 📋 策略調整建議
- ✅ 半導體產業此策略有效（80%成功率）
- ⚠️ 金融股需額外檢查外資0張陷阱
- ❌ 避免推薦已漲>10%的股票（即使符合條件）

## 🎯 優化後策略
法人一致買超 + 漲幅<5% + 產業邏輯明確 + 非外資0張
```

---

### 策略回測整合至週報

**週報新增章節**：
```markdown
## 七、策略有效性驗證

### 📊 本週驗證策略

**策略：法人一致買超**
- 本週符合：5檔
- 成功：4檔（80%）
- 失敗：1檔（外資0張陷阱）
- **結論：策略有效，但需檢查外資0張**

**策略：外資0張陷阱**
- 本週外資0張股票：8檔
- 若推薦會虧損：6檔（75%）
- **結論：外資0張確實是陷阱，必須避開**
```

---

## 📅 執行時間表

### 每日流程（維持現有）
- **09:00前**：盤前分析
- **12:30**：盤中分析
- **14:30後**：盤後分析 + **執行stock_tracker.py更新追蹤**

### 每週流程（新增）
- **週五15:00後**：週報
  - 統計本週推薦績效
  - 法人動向總結
  - 產業輪動分析
  - 下週展望

### 每月流程（新增）
- **月底週五**：月報
  - 本月產業趨勢
  - 月度準確率
  - 下月策略

### 不定期（累積數據後）
- **策略回測**：每累積30日數據執行一次
- **深度專題**：發現異常模式時（如外資0張持續擴大）

---

## 🛠️ 技術實現

### 需要開發的工具

**1. stock_tracker.py（個股追蹤）**
```python
功能：
- 讀取追蹤中股票清單
- 獲取今日收盤價、法人數據
- 更新追蹤狀態
- 產生7日追蹤報告

數據來源：
- Yahoo Finance（股價）
- 證交所API（法人數據）
```

**2. strategy_backtest.py（策略回測）**
```python
功能：
- 定義策略條件
- 掃描歷史數據（過去30日法人數據）
- 計算成功率、平均漲跌幅
- 產生回測報告

數據來源：
- data/每日法人數據
- 歷史股價（Yahoo Finance）
```

**3. weekly_report_generator.py（週報生成輔助）**
```python
功能：
- 自動統計本週推薦績效
- 自動統計本週法人動向
- 輔助生成週報（半自動）
```

---

### 需要創建的目錄結構

```
stock/
├── data/
│   ├── YYYY-MM-DD/               # 每日分析（現有）
│   ├── weekly/                   # 週報（新增）
│   │   └── YYYY-MM-DD_weekly_report.md
│   ├── monthly/                  # 月報（新增）
│   │   └── YYYY-MM_monthly_report.md
│   ├── tracking/                 # 個股追蹤（新增）
│   │   ├── tracking_YYYY-MM-DD.json
│   │   └── reports/
│   │       └── YYYY-MM-DD_7day_report.md
│   └── backtest/                 # 策略回測（新增）
│       └── strategy_XXX_YYYYMMDD.md
├── scripts/                      # 工具腳本（新增）
│   ├── stock_tracker.py
│   ├── strategy_backtest.py
│   └── weekly_report_generator.py
├── templates/                    # 範本（新增）
│   ├── weekly_report_template.md
│   └── monthly_report_template.md
└── docs/                         # 文檔（更新）
    ├── MARKET_NEWS_CHECKLIST.md  # 現有
    └── ENHANCED_ANALYSIS_SYSTEM_PLAN.md  # 本文件
```

---

## 📊 範例展示

### 週報範例（節錄）

```markdown
# 2025-11-18至11-22 週報

## 一、本週市場總結

### 📈 本週大盤表現
- 加權指數：23,456點（週漲+1.2%）
- 成交量：日均4,500億（較上週+8%)
- 族群表現：半導體+2.5%、金融股-1.8%

### 🌍 國際影響
- 輝達財報超預期（EPS +4%）
- NASDAQ週漲+1.8%
- 台積電ADR週漲+2.1%

## 二、本週法人動向

### 💰 投信本週策略
買超TOP5：
1. 富邦金 +58K（連續買超）
2. 台積電 +25K
3. 南亞 +22K

核心判斷：投信主攻金融股+AI供應鏈

### 🌏 外資本週策略
賣超TOP5：
1. 富邦金 -125K（激烈對決！）
2. 面板 -45K

核心判斷：外資賣金融股、買半導體

## 三、本週推薦股票績效

### ✅ 成功案例
| 股票 | 推薦價 | 週五收盤 | 漲幅 |
|------|--------|---------|------|
| 南亞 | 52.5 | 56.2 | +7.0% ✅ |
| 台積電 | 1405 | 1425 | +1.4% ✅ |

### ❌ 失敗案例
| 股票 | 推薦價 | 週五收盤 | 跌幅 | 失敗原因 |
|------|--------|---------|------|----------|
| 富邦金 | 98.5 | 95.2 | -3.4% | 外資0張陷阱 ❌ |

### 📊 本週準確率
- 推薦：10檔
- 成功：7檔（70%）

## 四、下週展望
- 11/21台積電法說會（重點關注）
- 金融股法人態度是否明確？
- 配置建議：現金60%、半導體30%、其他10%
```

---

## 🎯 預期效果

### 短期（1個月內）
- ✅ 建立週報機制，每週五產出
- ✅ 個股追蹤系統上線，自動追蹤推薦股票
- ✅ 累積30日數據，開始回測

### 中期（3個月內）
- ✅ 月報機制完善
- ✅ 策略回測驗證規則有效性
- ✅ 準確率提升至75%以上

### 長期（6個月以上）
- ✅ 累積足夠數據，建立量化選股模型
- ✅ 自動化推薦（AI輔助）
- ✅ 準確率穩定在80%以上

---

## 📋 實施步驟

### Phase 1: 設計階段（本次）
- [x] 規劃系統架構
- [ ] 設計週報範本
- [ ] 設計個股追蹤JSON格式
- [ ] 設計策略回測邏輯

### Phase 2: 開發階段（待批准）
- [ ] 開發 stock_tracker.py
- [ ] 開發 strategy_backtest.py
- [ ] 開發 weekly_report_generator.py
- [ ] 創建所需目錄結構

### Phase 3: 測試階段
- [ ] 手動執行第一份週報（11/22）
- [ ] 測試個股追蹤功能
- [ ] 執行第一次策略回測

### Phase 4: 正式上線
- [ ] 整合至CLAUDE.md
- [ ] 更新CONVERSATION_START_CHECKLIST.md
- [ ] 每週五固定產出週報

---

## ❓ 待確認事項

**Q1: 週報何時開始？**
- 選項A：本週五（11/22）立即開始
- 選項B：下週五（11/29）開始（累積數據）

**Q2: 個股追蹤追蹤幾天？**
- 目前規劃：7日
- 可調整：3日/5日/14日

**Q3: 策略回測回測幾天數據？**
- 目前規劃：30日
- 可調整：14日/60日/90日

**Q4: 工具開發優先級？**
- 優先：stock_tracker.py（個股追蹤最重要）
- 次要：weekly_report_generator.py（輔助工具）
- 最後：strategy_backtest.py（累積數據後再做）

---

**最後更新**：2025-11-20
**規劃者**：Claude
**批准狀態**：待批准

---

**下一步**：
1. 用戶批准此規劃
2. 開始開發 stock_tracker.py
3. 創建週報範本
4. 準備11/22第一份週報
