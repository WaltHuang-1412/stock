# 強化分析系統使用指南

**系統版本**：v1.0
**啟用日期**：2025-11-20
**包含功能**：週報、個股追蹤、策略回測（規劃中）

---

## 📋 系統概覽

### 三大支柱

```
1️⃣ 週報/月報系統
   - 每週五產出週報
   - 統計本週推薦績效
   - 法人動向總結
   - 產業輪動分析

2️⃣ 個股追蹤系統 ⭐ (已上線)
   - 推薦後自動追蹤7日
   - 每日更新價格+法人數據
   - 7日後產生追蹤報告

3️⃣ 策略回測系統 (累積數據後啟用)
   - 驗證策略有效性
   - 量化準確率
```

---

## 🎯 個股追蹤系統使用指南

### Step 1: 盤前推薦時建立追蹤記錄

**何時執行**：盤前分析推薦股票時

**手動建立**（目前）：
```bash
# 創建追蹤檔案
cp data/tracking/tracking_example.json data/tracking/tracking_2025-11-20.json

# 編輯JSON，填入推薦資訊
```

**JSON格式**：
```json
{
  "tracking_date": "2025-11-20",
  "recommendations": [
    {
      "stock_code": "1303",
      "stock_name": "南亞",
      "recommend_date": "2025-11-20",
      "recommend_price": 52.5,
      "recommend_reason": "投信+外資一致買超+18,075K",
      "target_price": 58.0,
      "stop_loss": 48.3,
      "position_size": "10-15%",
      "tracking_days": 7,
      "status": "tracking",
      "daily_updates": [
        {
          "date": "2025-11-20",
          "day": 0,
          "close_price": 52.5,
          "gain_loss_pct": 0.0,
          "volume": 25000,
          "institutional_data": {
            "investment_trust": 8234,
            "dealer": 523,
            "foreign": 9841,
            "total": 18598
          },
          "notes": "推薦日、開始追蹤"
        }
      ],
      "conclusion": null,
      "final_result": null
    }
  ],
  "metadata": {
    "created_at": "2025-11-20 09:00:00",
    "updated_at": "2025-11-20 15:00:00",
    "total_recommendations": 1,
    "tracking_active": 1,
    "tracking_completed": 0,
    "success_count": 0,
    "stop_loss_count": 0
  }
}
```

---

### Step 2: 每日盤後自動更新

**何時執行**：每日盤後14:30後

**執行指令**：
```bash
# 更新今日追蹤
python3 scripts/stock_tracker.py

# 或指定日期
python3 scripts/stock_tracker.py --date 20251120
```

**執行結果**：
```
📊 個股追蹤系統 - 2025-11-20
============================================================
找到 1 個追蹤文件

處理文件：tracking_2025-11-20.json
------------------------------------------------------------
✅ 南亞(1303): 56.2元 (+7.05%) - 📈 法人買超+3,421張 追蹤中 (2/7日)

============================================================
✅ 追蹤更新完成
📊 本次更新：1 檔
🎯 完成追蹤：0 檔
```

---

### Step 3: 7日後自動產生報告

**觸發條件**：
- 追蹤滿7日
- 或達目標價
- 或觸發停損

**報告位置**：
```
data/tracking/reports/2025-11-20_1303_7day_report.md
```

**報告範例**：
```markdown
# 南亞(1303) 7日追蹤報告

**推薦日期**：2025-11-20
**追蹤期間**：2025-11-20 至 2025-11-29（7日）

## 📊 推薦資訊
- **推薦價**：52.5元
- **目標價**：58.0元（+10.5%）
- **停損價**：48.3元（-8.0%）
- **推薦理由**：投信+外資一致買超+18,075K

## 📈 追蹤結果
- **7日收盤**：56.2元
- **漲跌幅**：**+7.05%**
- **狀態**：✅ 推薦成功

## 💰 法人態度
- **投信7日累計**：+15,234張
- **外資7日累計**：+22,145張
- **判斷**：✅ 法人持續買超

## 🎯 結論
### ✅ 推薦成功（7日漲幅+7.05%）
- 法人持續買超驗證策略有效
```

---

### Step 4: 整合至盤後分析

**盤後分析新增章節**：
```markdown
## 九、追蹤中股票更新

### 📊 7日內推薦股票追蹤

| 股票 | 推薦日 | 推薦價 | 現價 | 漲跌% | 天數 | 法人態度 | 狀態 |
|------|--------|--------|------|-------|------|---------|------|
| 南亞 | 11/20 | 52.5 | 56.2 | +7.0% | 2/7 | 續買超 | ✅追蹤中 |

### 🚨 今日達標/停損
- 無
```

---

## 📊 週報系統使用指南

### 何時產出

**時間**：每週五15:00後（盤後分析完成後）

**頻率**：每週一次

---

### 製作流程

**Step 1: 複製範本**
```bash
cp templates/weekly_report_template.md data/weekly/2025-11-18_weekly_report.md
```

**Step 2: 填寫內容**

參考範本填入：
1. 本週市場總結（大盤、美股、重大事件）
2. 本週法人動向（投信、外資、一致買超）
3. **本週推薦股票績效**（成功/失敗案例）
4. 產業輪動分析
5. 下週展望

**Step 3: 統計準確率**

```markdown
### 📊 本週準確率
- 推薦總數：10檔
- 成功（週漲幅>3%）：7檔
- 失敗（週跌幅<-3%）：2檔
- 震盪（±3%內）：1檔
- **本週準確率：70%**
```

---

### 週報範例（節錄）

```markdown
# 2025-11-18 至 2025-11-22 週報

## 三、本週推薦股票績效

### ✅ 成功案例

#### 1. 南亞(1303) - 週漲幅+7.0% ⭐⭐⭐⭐⭐

**推薦資訊**：
- 推薦日期：2025-11-20（週三）
- 推薦價：52.5元
- 週五收盤：56.2元
- 週漲幅：**+7.0%**

**推薦理由**：
- 投信+外資一致買超+18,075K
- 塑化產業復甦、產業邏輯明確

**成功關鍵**：
- ✅ 法人持續買超（週累計+22,XXX張）
- ✅ 產業邏輯兌現
- ✅ 推薦價位佳（買在起漲點）
```

---

## 🛠️ 故障排除

### 問題1：stock_tracker.py 無法獲取股價

**錯誤訊息**：
```
⚠️ 1303 無法獲取股價數據
```

**解決方法**：
1. 檢查網路連線
2. 確認股票代碼正確（台股需加.TW）
3. Yahoo Finance可能延遲，稍後重試

---

### 問題2：法人數據不可用

**錯誤訊息**：
```
⚠️ 1303 20251120 法人數據不可用
```

**解決方法**：
1. 確認證交所API是否正常
2. 盤後14:30前數據可能未公布
3. 週末/假日無法人數據

---

### 問題3：追蹤文件找不到

**錯誤訊息**：
```
ℹ️ 目前沒有追蹤中的股票
```

**解決方法**：
1. 確認 `data/tracking/` 目錄存在
2. 確認有 `tracking_YYYY-MM-DD.json` 文件
3. 手動建立追蹤文件（參考 Step 1）

---

## 📅 每日工作流程（整合後）

### 09:00前 - 盤前分析
1. ✅ 執行市場時事檢查（MARKET_NEWS_CHECKLIST.md）
2. ✅ 查詢法人數據、美股表現
3. ✅ 撰寫盤前分析
4. 🆕 **推薦股票時建立追蹤記錄**（tracking_YYYY-MM-DD.json）

### 12:30 - 盤中分析
1. ✅ 執行 intraday_dual_track.py
2. ✅ 分析盤前預測股票
3. ✅ 給出尾盤策略

### 14:30後 - 盤後分析
1. ✅ 查詢今日法人數據
2. 🆕 **執行 stock_tracker.py 更新追蹤**
3. ✅ 撰寫盤後分析
4. 🆕 **新增「追蹤中股票更新」章節**

### 週五15:00後 - 週報
1. 🆕 **統計本週推薦績效**
2. 🆕 **法人動向總結**
3. 🆕 **產業輪動分析**
4. 🆕 **下週展望**

---

## 📊 檔案結構總覽

```
stock/
├── data/
│   ├── tracking/                 # 個股追蹤
│   │   ├── tracking_2025-11-20.json
│   │   ├── tracking_example.json
│   │   └── reports/              # 7日追蹤報告
│   │       └── 2025-11-20_1303_7day_report.md
│   ├── weekly/                   # 週報
│   │   └── 2025-11-18_weekly_report.md
│   ├── monthly/                  # 月報
│   │   └── 2025-11_monthly_report.md
│   └── backtest/                 # 策略回測
│       └── strategy_法人一致買超_20251120.md
├── scripts/
│   └── stock_tracker.py          # 個股追蹤工具 ⭐
├── templates/
│   └── weekly_report_template.md # 週報範本
└── docs/
    ├── ENHANCED_ANALYSIS_SYSTEM_PLAN.md  # 系統規劃
    └── ENHANCED_SYSTEM_USAGE.md          # 本文件
```

---

## 🎯 下一步開發

### Phase 2: 自動化增強（1週內）
- [ ] 盤前推薦時自動建立追蹤記錄
- [ ] weekly_report_generator.py（輔助工具）

### Phase 3: 策略回測（1個月後）
- [ ] 累積30日數據
- [ ] 開發 strategy_backtest.py
- [ ] 驗證策略有效性

### Phase 4: 完全自動化（3個月後）
- [ ] 推薦→追蹤→週報 全自動化
- [ ] 準確率持續追蹤
- [ ] AI輔助推薦

---

## 📝 常見問題

### Q1: 為什麼追蹤7日？
A: 法人吸貨需要時間，3日太短、14日太長。7日是平衡點。

### Q2: 準確率如何計算？
A: 7日漲幅>3%算成功、<-3%算失敗、±3%內算中性。

### Q3: 週報何時開始？
A: 本週五（11/22）開始，累積數據後會更完整。

### Q4: 個股追蹤會自動執行嗎？
A: 目前手動執行 `python3 scripts/stock_tracker.py`，未來可設定cron自動執行。

---

**最後更新**：2025-11-20
**維護者**：Claude + Walter
**問題回報**：在使用中發現問題請記錄
