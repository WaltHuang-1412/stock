# 數據驗證協議 - 如何確認每次分析資料正確

**建立日期**：2025-11-20
**核心目的**：讓用戶能夠快速驗證AI輸出的數據正確性

---

## 🎯 核心原則

### ❌ 錯誤做法
```
用戶：「盤前分析」
AI：（直接產出完整分析報告）
用戶：「這些數據正確嗎？」❌ 無法驗證
```

### ✅ 正確做法（三階段驗證）
```
階段1：數據來源展示（AI輸出原始數據+來源連結）
階段2：用戶驗證（用戶自行對照官方網站/工具）
階段3：批准後撰寫（用戶確認「OK」後AI才開始撰寫）
```

---

## 📋 三階段驗證流程（已強制執行）

### 階段1️⃣：AI展示原始數據（分析前）

**我會輸出**：
```markdown
我即將執行盤前分析，先展示關鍵數據：

## 📊 法人數據（2025/11/19）

**來源**：https://www.twse.com.tw/rwd/en/fund/T86?date=20251119&selectType=ALL&response=json

**買超TOP5**（原始數據）：
| 代號 | 名稱 | 投信(千股) | 外資(千股) | 自營商(千股) | 三大法人(千股) |
|------|------|----------|----------|------------|-------------|
| 2891 | 中信金 | -8,900 | 0 | +1,781 | +9,747 |
| 3711 | 日月光 | -6,554 | +14,642 | -469 | +7,619 |
| 2301 | 光寶科 | -8,095 | +16,300 | -607 | +7,598 |

**⚠️ 注意事項**：
- 外資0張可能是陷阱（中信金、元大金、永豐金、兆豐金）
- 需用check_institutional.py驗證

## 🇺🇸 美股數據（2025/11/19收盤）

**來源**：Yahoo Finance

- NASDAQ：22,564.23（+0.6%）
- S&P500：6,642.16（+0.4%）
- 台積電ADR：$280.91（+1.08%）

## 📋 預計推薦範圍

✅ 可能推薦：0檔（法人對決嚴重）
❌ 避開：金融股（外資0張陷阱）

---

✋ **請驗證以上數據**：
1. 法人數據連結是否可開啟？
2. 數據是否為11/19？
3. 外資0張股票是否正確？
4. 美股數據是否合理？

**確認後請回覆「OK」或「有問題」**
```

---

### 階段2️⃣：用戶驗證（你的工作）

**你需要做的**：

#### ✅ 驗證1：法人數據官方網站核對

**步驟**：
1. 點擊我提供的連結
2. 對照網頁上的數字
3. 檢查日期是否正確

**範例**：
```
我的輸出：
中信金(2891)：投信-8,900、外資0、三大法人+9,747

官網顯示：
中信金(2891)：投信-8,900 ✅、外資0 ✅、三大法人+9,747 ✅

→ 數據正確！
```

**檢查要點**：
- [ ] 日期正確（URL中的date=20251119）
- [ ] 前3名股票代碼、名稱正確
- [ ] 投信、外資、三大法人數字正確（允許±100張誤差）
- [ ] 外資0張標註正確

---

#### ✅ 驗證2：check_institutional.py工具驗證

**步驟**：
```bash
# 驗證我標註的「外資0張」股票
python3 check_institutional.py 2891 20251119

# 輸出範例：
中信金(2891) 2025/11/19 法人買賣超：
外資及陸資(不含外資自營商)：0 張
投信：-8,900 張
自營商(自行買賣)：+1,781 張
三大法人買賣超合計：+9,747 張
```

**檢查要點**：
- [ ] 外資確實是0張（不是+1或-1）
- [ ] 投信數字一致
- [ ] 三大法人合計正確

---

#### ✅ 驗證3：美股數據快速驗證

**方法1：Google搜尋**
```
搜尋：「NASDAQ 11/19」
Google會顯示：22,564.23 (+0.6%)
→ 對照我的輸出
```

**方法2：Yahoo Finance**
```
https://finance.yahoo.com/quote/%5EIXIC/
→ 看前一日收盤價
```

**檢查要點**：
- [ ] NASDAQ漲跌方向正確（漲/跌）
- [ ] 漲跌幅合理（±2%內）
- [ ] 台積電ADR合理（與台股連動）

---

#### ✅ 驗證4：邏輯合理性檢查

**我的推薦邏輯**：
```
若我說：
「推薦南亞(1303)，理由：投信+外資一致買超+18,075K」

你檢查：
1. 法人數據確實是投信+外資同向買超？✅
2. 合計確實+18,075K？✅
3. 沒有「外資0張」？✅
4. 產業邏輯合理？✅

→ 推薦合理
```

**若我說**：
```
「推薦富邦金(2881)，理由：投信買超+25,411K」

你檢查：
1. 投信+25,411K ✅
2. 但外資-39,700K ❌（法人對決！）
3. 或外資0張 ❌（陷阱！）

→ 推薦不合理，質疑我
```

---

### 階段3️⃣：批准後撰寫（我的工作）

**你回覆「OK」後**：
```
用戶：「OK」

我：「開始撰寫盤前分析...」
（產出完整報告）
```

**若你發現問題**：
```
用戶：「等等，中信金外資不是0張，是-8,900張」

我：「立即修正！重新查詢...」
（修正後再次展示數據）
```

---

## 🛠️ 驗證工具清單

### 1. 官方網站驗證

**法人數據**：
```
https://www.twse.com.tw/rwd/en/fund/T86?date=YYYYMMDD&selectType=ALL&response=json

使用方式：
1. 我會提供完整URL
2. 你點擊開啟
3. 對照前5名數據即可
```

**美股數據**：
```
Google搜尋：「NASDAQ」「S&P500」「台積電ADR」
→ 直接顯示最新收盤價
```

---

### 2. 命令列工具驗證

**check_institutional.py**：
```bash
# 驗證單一股票法人數據
python3 check_institutional.py 1303 20251119

# 用途：
- 驗證外資是否0張
- 驗證投信買超數字
- 交叉比對證交所API
```

**快速驗證多檔**：
```bash
# 驗證我推薦的所有股票
python3 check_institutional.py 1303 20251119
python3 check_institutional.py 2330 20251119
python3 check_institutional.py 2885 20251119
```

---

### 3. 券商軟體對照（最準確）

**股價驗證**：
```
我的輸出：南亞收盤52.5元

券商軟體：南亞收盤52.5元 ✅

→ 確認正確
```

**法人數據驗證**：
```
我的輸出：南亞 投信+8,234、外資+9,841

券商軟體法人買賣超：
投信+8,234 ✅
外資+9,841 ✅

→ 確認正確
```

---

## 📊 快速驗證檢查表（5分鐘完成）

### 盤前分析驗證

**必檢項目**（只需5分鐘）：

```
□ 法人數據日期正確？（URL中的date=20251119）
□ 點擊證交所連結，對照TOP3股票數字
□ 用check_institutional.py驗證「外資0張」股票（1-2檔）
□ Google搜尋「NASDAQ」確認美股方向
□ 推薦邏輯合理？（投信+外資同向、無外資0張）

✅ 5項都通過 → 回覆「OK」
❌ 任一項有問題 → 質疑我並要求修正
```

---

### 盤後分析驗證

**必檢項目**：

```
□ 法人數據15:00後才執行？
□ stock_tracker.py輸出股價合理？（對照券商軟體）
□ 追蹤股票漲跌幅計算正確？
  （現價-推薦價）/推薦價 * 100 = 漲跌幅%
□ 法人數據已更新？（對照證交所網站）

✅ 都通過 → 信任輸出
❌ 有問題 → 質疑我
```

---

## 🚨 常見錯誤偵測

### 錯誤1：日期錯誤

**我可能犯的錯**：
```
11/20盤前分析，但使用11/18法人數據 ❌
（應該用11/19數據）
```

**你的檢查**：
```
我提供的URL：
https://www.twse.com.tw/rwd/en/fund/T86?date=20251118 ❌

應該是：
https://www.twse.com.tw/rwd/en/fund/T86?date=20251119 ✅

→ 發現錯誤，要求我修正
```

---

### 錯誤2：外資0張誤判

**我可能犯的錯**：
```
「推薦元大金，投信+4,396K、外資+1,845K」❌
（實際外資0張，API顯示錯誤）
```

**你的檢查**：
```bash
python3 check_institutional.py 2885 20251119

輸出：
外資及陸資：0 張 ❌（我說+1,845K）

→ 發現矛盾，質疑我
```

---

### 錯誤3：計算錯誤

**我可能犯的錯**：
```
推薦價：52.5元
目標價：55元（+10%）❌
（實際55/52.5-1 = 4.76%）
```

**你的檢查**：
```
計算器驗證：
(55 - 52.5) / 52.5 * 100 = 4.76%

→ 發現我算錯，要求修正
```

---

## 💡 進階驗證（選做）

### 產業邏輯驗證

**我的推薦**：
```
「推薦南亞，理由：輝達財報超預期、塑化需求增加」
```

**你的驗證**：
```
Google搜尋：「輝達財報 2025/11/19」
→ 確認輝達財報確實超預期 ✅

Google搜尋：「塑化 需求 2025」
→ 確認塑化產業確實復甦 ✅

→ 產業邏輯合理
```

---

### 歷史準確率驗證

**我的聲稱**：
```
「近4週準確率70%」
```

**你的驗證**：
```
查看週報：
- 第1週：7/10（70%）✅
- 第2週：6/10（60%）
- 第3週：8/10（80%）
- 第4週：7/10（70%）

平均：(70+60+80+70)/4 = 70% ✅

→ 聲稱正確
```

---

## ✅ 驗證標準作業程序（SOP）

### 每次分析前（用戶執行）

**時間**：3-5分鐘

**步驟**：
```
1. AI展示數據來源
   ↓
2. 點擊證交所連結，對照TOP3股票
   ↓
3. 執行check_institutional.py驗證外資0張
   ↓
4. Google搜尋NASDAQ確認美股方向
   ↓
5. 檢查推薦邏輯合理性
   ↓
6. 回覆「OK」或「有問題」
```

---

### 發現錯誤時（用戶行動）

**立即質疑**：
```
用戶：「等等，中信金外資不是0張，是-8,900張」

AI：「立即修正！重新查詢證交所API...」
（重新展示正確數據）
```

**要求重新驗證**：
```
用戶：「請重新列出數據來源，我再檢查一次」

AI：「好的，重新列出...」
```

**拒絕批准**：
```
用戶：「數據有問題，先不要撰寫分析」

AI：「了解，暫停撰寫，等待數據確認」
```

---

## 📋 驗證檢查表範本

### 盤前分析驗證表

```
日期：2025/11/20
分析類型：盤前分析

□ 法人數據日期：11/19 ✅
□ 證交所連結可開啟：✅
□ TOP3股票數字核對：
  - 中信金：-8,900 / 0 / +9,747 ✅
  - 日月光：-6,554 / +14,642 / +7,619 ✅
  - 光寶科：-8,095 / +16,300 / +7,598 ✅
□ check_institutional.py驗證外資0張：
  - 中信金：0張 ✅
  - 元大金：0張 ✅
□ 美股數據（Google）：
  - NASDAQ +0.6% ✅
□ 推薦邏輯：
  - 無推薦（法人對決） ✅

✅ 驗證通過，回覆「OK」
```

---

## 🎯 用戶最小化驗證指南

### 最少驗證（3分鐘）

**只檢查3項關鍵點**：

1. **日期正確**
   ```
   URL中：date=20251119
   今天是11/20 → 前一日11/19 ✅
   ```

2. **TOP1股票數字正確**
   ```
   點擊證交所連結
   對照第1名股票數字
   ✅ 正確
   ```

3. **推薦邏輯合理**
   ```
   推薦股票有「外資0張」？
   ❌ 有 → 質疑
   ✅ 無 → OK
   ```

---

### 標準驗證（5分鐘）

**檢查5項**：

1. 日期正確
2. TOP3股票數字正確
3. check_institutional.py驗證1檔
4. Google搜尋NASDAQ
5. 推薦邏輯合理

---

### 完整驗證（10分鐘）

**所有項目**：

1. 日期正確
2. TOP5股票數字正確
3. check_institutional.py驗證所有推薦股票
4. 美股數據完整驗證
5. 推薦邏輯+產業邏輯驗證
6. 價格計算驗證

---

## 🔧 自動化驗證工具（規劃中）

### 未來改進方向

**自動驗證腳本**：
```python
# scripts/auto_verify.py

def verify_analysis(analysis_file):
    """自動驗證分析文件數據正確性"""

    # 1. 提取文件中的法人數據
    # 2. 對照證交所API
    # 3. 驗證外資0張標註
    # 4. 驗證計算正確性
    # 5. 輸出驗證報告

    return verification_report
```

**執行方式**：
```bash
python3 scripts/auto_verify.py data/2025-11-20/before_market_analysis.md

# 輸出：
✅ 法人數據正確
✅ 外資0張標註正確
❌ 目標價計算錯誤（應為+4.76%，文件寫+10%）
```

---

## 📊 總結

### 如何確認我的數據正確？

**三階段驗證**：
1. **我展示原始數據+來源**（分析前）
2. **你快速驗證3-5項**（3-5分鐘）
3. **批准後我才撰寫**

### 最小化驗證（必做）

**只需3分鐘**：
- ✅ 檢查日期正確
- ✅ 點擊證交所連結對照TOP1股票
- ✅ check_institutional.py驗證1檔外資0張

### 發現錯誤時

**立即質疑**：
```
用戶：「數據有問題」
AI：「立即修正」
```

**系統已強制執行三階段驗證，你的工作是快速檢查關鍵點** ✅

---

**最後更新**：2025-11-20
**強制執行**：所有分析必須遵守此協議
