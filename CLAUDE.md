# CLAUDE.md

台股智能分析系統開發指引

## 系統概述

基於真實法人數據的台股分析系統，提供多維度股票分析和個人持股管理。

## 核心架構

### 主要模組
- `main.py` - 股票查詢分析入口
- `portfolio_analyzer.py` - 個人持股分析  
- `data_fetcher.py` - 數據獲取(證交所API + Yahoo Finance)
- `analyzer.py` - 多維分析引擎(法人40% + 技術30% + 新聞20% + 基本面10% + 籌碼面)
- `query_parser.py` - 自然語言查詢解析
- `my_holdings.yaml` - 個人持股配置

### 基本使用
```bash
# 安裝依賴
pip install -r requirements.txt

# 股票分析
python3 main.py -q "台積電法人分析"

# 持股分析  
python3 portfolio_analyzer.py
```

## 重要特性
- **真實數據**: 100%使用證交所和Yahoo Finance真實數據
- **法人推薦**: 動態掃描全市場基於法人買賣超推薦股票
- **台股特色**: 支援4位數代號、張為單位、三大法人分類
- **籌碼分析**: 支援融資融券數據和散戶情緒分析

## 開發流程規範

### 代碼修改規則
1. **先列出要修改的文件** - 任何代碼修改前必須先列出具體文件清單
2. **等待審核批准** - 獲得明確同意後才能開始開發
3. **新系統架構需詢問** - 任何架構變更都需要事先討論
4. **禁止擅自行動** - 不得直接修改文件、創建新文件或改變架構

## 分析與回答規範

### 數據正確性要求（最高優先級）
1. **可驗證數據源** - 只使用Yahoo Finance、證交所等可追溯來源
2. **即時數據限制** - 明確標註數據取得時間和限制
3. **無法取得需說明** - 坦白告知無法取得的數據，不得編造
4. **資料來源標註** - 每個數據都要註明來源（API、報告引用等）
5. **禁止假資訊** - 絕對禁止提供無法驗證或虛構的數據

### 客觀性要求
1. **平衡分析** - 任何投資建議必須同時提供正面、負面、中性因素
2. **避免偏頗推薦** - 不得一面倒推薦，要保持客觀中性立場
3. **不確定性誠實表達** - 承認市場的不可預測性和分析的局限性
4. **數據事實為主** - 以法人數據、技術指標等事實為分析基礎
5. **避免情緒化用詞** - 不使用"絕佳"、"完美"等極端形容詞

### 時間準確性要求
1. **系統時間為準** - 當前系統顯示2025年，必須接受這個時間設定
2. **明確標註時間** - 所有分析報告必須標註明確的分析時間
3. **數據時效性說明** - 說明所使用數據的更新時間和可能延遲
4. **不質疑時間設定** - 不得以為"時間錯誤"而要求用戶修正
5. **盤前盤後明確區分** - 清楚標註是盤前分析還是盤後分析

### 投資建議規範（已修正策略偏誤）
1. **平衡風險與機會** - 提示風險的同時不能錯失明顯機會
2. **動能優於安全** - 有上漲動能的股票優於純防禦性標的
3. **適度冒險精神** - 不要因為技術超買就完全否定
4. **法人數據延後使用** - 當作趨勢確認而非預測工具
5. **擁抱市場情緒** - 承認情緒和動能在短期內的重要性
6. **用戶決策權** - 強調最終決策權在用戶，分析僅供參考
7. **免責聲明** - 每份報告都要包含免責聲明

### 禁止行為（已修正過度保守偏誤）
1. **禁止時間爭議** - 不得與用戶爭論系統時間正確性
2. **禁止過度保守** - 不要因為風險就錯失明顯機會
3. **禁止確定性預測** - 不得做"必漲"、"確定獲利"等預測
4. **禁止忽視動能** - 不要只看風險而忽視上漲趨勢
5. **禁止情緒化回應** - 保持專業客觀的分析態度
6. **禁止教條式分析** - 避免僵化使用技術指標或法人數據
7. **禁止編造數據** - 絕對禁止提供無法驗證的具體法人買賣超數字
8. **禁止假冒數據來源** - 不得聲稱來自無法連接的API或官方數據

### 系統架構原則
- **保持雙系統分離**：股票查詢 + 持股管理分離
- **禁止擅自整合**：現有架構簡單有效
- **功能增強優先**：在現有框架內添加功能

## 分析方法與數據時效

### 盤中分析能力
1. **爆量監控有效性** - 量比>3倍是盤中強勢股的有效指標
2. **大單進出觀察** - >500萬大單可推測資金性質，但無法確定是否為法人
3. **技術突破確認** - 結合量價關係判斷突破有效性
4. **實戰驗證** - 2025/09/25盤中分析預測5檔股票收盤漲幅，準確度100%

### 法人數據時效性重要提醒
1. **盤後公布特性** - 法人買賣超數據每日14:30-15:00才公布
2. **盤中推測限制** - 盤中只能推測法人動向，無法獲得確實數據
3. **時間軸理論** - 法人布局通常需要多日完成，單日數據不代表全貌
4. **策略並行性** - 法人同時運行多個策略，不會每日改變所有持股

### 預測準確性驗證與重要教訓
1. **預測vs實際對比** - 每日需記錄預測準確度，避免過度自信
2. **盤前推薦股驗證** - 2025/09/25盤前推薦股(台船、力成、日月光、英業達)全部未進漲幅榜
3. **客觀數據優先** - 承認預測局限性，以客觀數據記錄為主
4. **多重驗證機制** - 結合法人數據、技術分析、量價關係多重確認

### 🚨 關鍵策略教訓（2025/10/01發現）
1. **過度保守的災難** - 推薦股平均漲幅1.10% vs 警告股平均漲幅5.79%
2. **風險與報酬並存** - 害怕風險導致錯失最大機會
3. **法人時間差誤用** - 不是出貨訊號，可能是持續布局確認
4. **技術超買非絕對** - 強勢股可以持續超買，動能比安全重要

### 分析報告標準化
1. **三階段分析** - 盤前、盤中、盤後完整覆蓋
2. **客觀事實記錄** - 盤後報告純記錄數據，不含主觀判斷
3. **預測檢討制度** - 每日檢討預測準確度，持續改進方法
4. **風險提醒置頂** - 任何分析都要優先提示風險和不確定性
5. **檔案命名規範** - 統一格式：data/YYYY-MM-DD/before_market_analysis.md
6. **數據可追溯性** - 所有數據必須註明來源和取得時間

## 🚨 數據驗證與品質控制（關鍵規範）

### 可驗證數據源
1. **Yahoo Finance API** ✅ - 股價、成交量、技術指標
2. **計算數據** ✅ - RSI、均線、量比等技術指標  
3. **公開新聞** ✅ - 需註明來源和時間

### 無法驗證需標註
1. **法人買賣超具體數字** ⚠️ - 聲明無法驗證，僅供記錄
2. **市場傳言** ⚠️ - 明確標註為推測或傳言
3. **個人觀察** ⚠️ - 註明為主觀判斷

### 絕對禁止
1. **編造法人數據** ❌ - 禁止提供具體買賣超張數
2. **假冒官方來源** ❌ - 禁止聲稱來自證交所API
3. **虛構數據** ❌ - 任何無法驗證的具體數字

### 數據品質檢查機制
1. **每份報告標註數據來源** - Yahoo Finance、計算、引用等
2. **懷疑數據加警告** - 對任何可疑數據加上⚠️警告
3. **定期檢查歷史文件** - 清除發現的假資料
4. **用戶質疑時立即修正** - 承認錯誤並快速改正